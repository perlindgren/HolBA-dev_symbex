open HolKernel Parse

open bir_inst_liftingLib;
open bmil_arm8

val _ = Parse.current_backend := PPBackEnd.vt100_terminal;


(* Test it with the instructions from aes example *)
val instrs = [
  "D101C3FF","F9000FE0","B90017E1","F90007E2","F90003E3","B94017E0","51000400",
  "B9004FE0","F94007E0","B9400000","B9002FE0","F94007E0","B9400400","B90033E0",
  "F94007E0","B9400800","B90037E0","F94007E0","B9400C00","B9003BE0","F9400FE0",
  "B9400000","B9402FE1","4A000020","B9002FE0","F9400FE0","91001000","B9400000",
  "B94033E1","4A000020","B90033E0","F9400FE0","91002000","B9400000","B94037E1",
  "4A000020","B90037E0","F9400FE0","91003000","B9400000","B9403BE1","4A000020",
  "B9003BE0","F9400FE0","91004000","F9000FE0","140000E6","B9402FE0","53187C00",
  "B90053E0","B94033E0","53107C00","12001C00","B90057E0","B94037E0","53087C00",
  "12001C00","B9005BE0","B9403BE0","12001C00","B9005FE0","B94053E0","D37EF401",
  "90000000","91394000","8B000020","B9400000","B90063E0","B94057E0","D37EF401",
  "B0000000","91094000","8B000020","B9400000","B90067E0","B9405BE0","D37EF401",
  "B0000000","91194000","8B000020","B9400000","B9006BE0","B9405FE0","D37EF401",
  "B0000000","91294000","8B000020","B9400000","B9006FE0","B94063E1","B94067E0",
  "4A000021","B9406BE0","4A000021","B9406FE0","4A000021","F9400FE0","B9400000",
  "4A000020","B9003FE0","B94033E0","53187C00","B90053E0","B94037E0","53107C00",
  "12001C00","B90057E0","B9403BE0","53087C00","12001C00","B9005BE0","B9402FE0",
  "12001C00","B9005FE0","B94053E0","D37EF401","90000000","91394000","8B000020",
  "B9400000","B90063E0","B94057E0","D37EF401","B0000000","91094000","8B000020",
  "B9400000","B90067E0","B9405BE0","D37EF401","B0000000","91194000","8B000020",
  "B9400000","B9006BE0","B9405FE0","D37EF401","B0000000","91294000","8B000020",
  "B9400000","B9006FE0","B94063E1","B94067E0","4A000021","B9406BE0","4A000021",
  "B9406FE0","4A000021","F9400FE0","91001000","B9400000","4A000020","B90043E0",
  "B94037E0","53187C00","B90053E0","B9403BE0","53107C00","12001C00","B90057E0",
  "B9402FE0","53087C00","12001C00","B9005BE0","B94033E0","12001C00","B9005FE0",
  "B94053E0","D37EF401","90000000","91394000","8B000020","B9400000","B90063E0",
  "B94057E0","D37EF401","B0000000","91094000","8B000020","B9400000","B90067E0",
  "B9405BE0","D37EF401","B0000000","91194000","8B000020","B9400000","B9006BE0",
  "B9405FE0","D37EF401","B0000000","91294000","8B000020","B9400000","B9006FE0",
  "B94063E1","B94067E0","4A000021","B9406BE0","4A000021","B9406FE0","4A000021",
  "F9400FE0","91002000","B9400000","4A000020","B90047E0","B9403BE0","53187C00",
  "B90053E0","B9402FE0","53107C00","12001C00","B90057E0","B94033E0","53087C00",
  "12001C00","B9005BE0","B94037E0","12001C00","B9005FE0","B94053E0","D37EF401",
  "90000000","91394000","8B000020","B9400000","B90063E0","B94057E0","D37EF401",
  "B0000000","91094000","8B000020","B9400000","B90067E0","B9405BE0","D37EF401",
  "B0000000","91194000","8B000020","B9400000","B9006BE0","B9405FE0","D37EF401",
  "B0000000","91294000","8B000020","B9400000","B9006FE0","B94063E1","B94067E0",
  "4A000021","B9406BE0","4A000021","B9406FE0","4A000021","F9400FE0","91003000",
  "B9400000","4A000020","B9004BE0","B9403FE0","B9002FE0","B94043E0","B90033E0",
  "B94047E0","B90037E0","B9404BE0","B9003BE0","F9400FE0","91004000","F9000FE0",
  "B9404FE0","51000400","B9004FE0","B9404FE0","7100001F","54FFE321","B9403FE0",
  "53187C00","B90053E0","B94043E0","53107C00","12001C00","B90057E0","B94047E0",
  "53087C00","12001C00","B9005BE0","B9404BE0","12001C00","B9005FE0","B94053E0",
  "D37EF401","B0000000","91194000","8B000020","B9400000","B90063E0","B94057E0",
  "D37EF401","B0000000","91294000","8B000020","B9400000","B90067E0","B9405BE0",
  "D37EF401","90000000","91394000","8B000020","B9400000","B9006BE0","B9405FE0",
  "D37EF401","B0000000","91094000","8B000020","B9400000","B9006FE0","B94063E0",
  "12081C01","B94067E0","12101C00","4A000021","B9406BE0","12181C00","4A000021",
  "B9406FE0","12001C00","4A000021","F9400FE0","B9400000","4A000020","B9002FE0",
  "B94043E0","53187C00","B90053E0","B94047E0","53107C00","12001C00","B90057E0",
  "B9404BE0","53087C00","12001C00","B9005BE0","B9403FE0","12001C00","B9005FE0",
  "B94053E0","D37EF401","B0000000","91194000","8B000020","B9400000","B90063E0",
  "B94057E0","D37EF401","B0000000","91294000","8B000020","B9400000","B90067E0",
  "B9405BE0","D37EF401","90000000","91394000","8B000020","B9400000","B9006BE0",
  "B9405FE0","D37EF401","B0000000","91094000","8B000020","B9400000","B9006FE0",
  "B94063E0","12081C01","B94067E0","12101C00","4A000021","B9406BE0","12181C00",
  "4A000021","B9406FE0","12001C00","4A000021","F9400FE0","91001000","B9400000",
  "4A000020","B90033E0","B94047E0","53187C00","B90053E0","B9404BE0","53107C00",
  "12001C00","B90057E0","B9403FE0","53087C00","12001C00","B9005BE0","B94043E0",
  "12001C00","B9005FE0","B94053E0","D37EF401","B0000000","91194000","8B000020",
  "B9400000","B90063E0","B94057E0","D37EF401","B0000000","91294000","8B000020",
  "B9400000","B90067E0","B9405BE0","D37EF401","90000000","91394000","8B000020",
  "B9400000","B9006BE0","B9405FE0","D37EF401","B0000000","91094000","8B000020",
  "B9400000","B9006FE0","B94063E0","12081C01","B94067E0","12101C00","4A000021",
  "B9406BE0","12181C00","4A000021","B9406FE0","12001C00","4A000021","F9400FE0",
  "91002000","B9400000","4A000020","B90037E0","B9404BE0","53187C00","B90053E0",
  "B9403FE0","53107C00","12001C00","B90057E0","B94043E0","53087C00","12001C00",
  "B9005BE0","B94047E0","12001C00","B9005FE0","B94053E0","D37EF401","B0000000",
  "91194000","8B000020","B9400000","B90063E0","B94057E0","D37EF401","B0000000",
  "91294000","8B000020","B9400000","B90067E0","B9405BE0","D37EF401","90000000",
  "91394000","8B000020","B9400000","B9006BE0","B9405FE0","D37EF401","B0000000",
  "91094000","8B000020","B9400000","B9006FE0","B94063E0","12081C01","B94067E0",
  "12101C00","4A000021","B9406BE0","12181C00","4A000021","B9406FE0","12001C00",
  "4A000021","F9400FE0","91003000","B9400000","4A000020","B9003BE0","F94003E0",
  "B9402FE1","B9000001","F94003E0","91001000","B94033E1","B9000001","F94003E0",
  "91002000","B94037E1","B9000001","F94003E0","91003000","B9403BE1","B9000001",
  "D503201F","9101C3FF","D65F03C0"
];


val _ = print "writing Intel HEX file: aes-test-aarch64.hex\n"
val _ = print "try running:\n\n  aarch64-linux-gnu-objdump -m aarch64 -D aes-aarch64.hex\n\n";
val _ = write_hex_file "aes-test-aarch64.hex" [
   mk_bir_inst_lifting_region (Arbnum.fromInt 0x400570) instrs]

val _ = print "reading Intel HEX file: aes-test-aarch64.hex\n\n"
val aes_sections = read_hex_file "aes-test-aarch64.hex"
